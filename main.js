/*
SANKRYPT v1.0 - Professional Encryption
Military-grade AES-256-GCM encryption for your notes
===================================================
WARNING: Keep your master password safe! 
It cannot be recovered if lost.
===================================================
*/
var J=Object.defineProperty;var tt=(x,t,s)=>t in x?J(x,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):x[t]=s;var L=(x,t,s)=>(tt(x,typeof t!="symbol"?t+"":t,s),s);var v=class{static async deriveKey(t,s){let e=new TextEncoder,r=await crypto.subtle.importKey("raw",e.encode(t),"PBKDF2",!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:this.ITERATIONS,hash:"SHA-256"},r,{name:this.ALGORITHM,length:this.KEY_LENGTH},!1,["encrypt","decrypt"])}static async encrypt(t,s){try{let e=crypto.getRandomValues(new Uint8Array(this.SALT_LENGTH)),r=crypto.getRandomValues(new Uint8Array(this.IV_LENGTH)),n=await this.deriveKey(s,e),o=new TextEncoder().encode(t),c=await crypto.subtle.encrypt({name:this.ALGORITHM,iv:r},n,o),l=1+e.length+r.length+c.byteLength,a=new Uint8Array(l);return a[0]=1,a.set(e,1),a.set(r,1+e.length),a.set(new Uint8Array(c),1+e.length+r.length),this.arrayToBase64(a)}catch(e){throw console.error("Sankrypt encryption error:",e),new Error(`Encryption failed: ${e.message}`)}}static async decrypt(t,s){try{let e=this.base64ToArray(t);if(e[0]!==1)throw new Error("Unsupported encryption version");let n=e.slice(1,1+this.SALT_LENGTH),i=e.slice(1+this.SALT_LENGTH,1+this.SALT_LENGTH+this.IV_LENGTH),o=e.slice(1+this.SALT_LENGTH+this.IV_LENGTH),c=await this.deriveKey(s,n),l=await crypto.subtle.decrypt({name:this.ALGORITHM,iv:i},c,o);return new TextDecoder().decode(l)}catch(e){throw console.error("Sankrypt decryption error:",e),e.message.includes("wrong key")||e.name==="OperationError"?new Error("Decryption failed: Incorrect password or corrupted data"):e.message.includes("Unsupported encryption version")?new Error("Decryption failed: File was encrypted with an unsupported version"):e}}static validatePassword(t){let s=[];return t.length<12&&s.push("Password must be at least 12 characters"),/[a-z]/.test(t)||s.push("Password must contain lowercase letters"),/[A-Z]/.test(t)||s.push("Password must contain uppercase letters"),/[0-9]/.test(t)||s.push("Password must contain numbers"),/[^a-zA-Z0-9]/.test(t)||s.push("Password must contain special characters"),{isValid:s.length===0,issues:s,strength:this.calculatePasswordStrength(t)}}static calculatePasswordStrength(t){let s=0;t.length>=12&&(s+=25),t.length>=16&&(s+=10),t.length>=20&&(s+=10),/[a-z]/.test(t)&&(s+=10),/[A-Z]/.test(t)&&(s+=10),/[0-9]/.test(t)&&(s+=10),/[^a-zA-Z0-9]/.test(t)&&(s+=15);let e=new Set(t).size;return s+=Math.min(20,e/t.length*40),Math.min(100,s)}static arrayToBase64(t){return btoa(String.fromCharCode(...t))}static base64ToArray(t){let s=atob(t),e=new Uint8Array(s.length);for(let r=0;r<s.length;r++)e[r]=s.charCodeAt(r);return e}static generatePasswordHint(t){if(!t||t.length<3)return"";let s=t[0],e=t[t.length-1],r=t.length;return`Starts with "${s}", ends with "${e}", ${r} chars`}static async testPassword(t){try{let s="Sankrypt encryption test",e=await this.encrypt(s,t);return await this.decrypt(e,t)===s}catch{return!1}}};L(v,"ALGORITHM","AES-GCM"),L(v,"KEY_LENGTH",256),L(v,"ITERATIONS",31e4),L(v,"SALT_LENGTH",16),L(v,"IV_LENGTH",12);var R=require("obsidian");function b(x,t=16,s="currentColor"){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");switch(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width",t.toString()),e.setAttribute("height",t.toString()),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke",s),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.style.display="inline-block",e.style.verticalAlign="middle",e.style.color=s,x){case"LOCK":let r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("width","18"),r.setAttribute("height","11"),r.setAttribute("x","3"),r.setAttribute("y","11"),r.setAttribute("rx","2"),r.setAttribute("ry","2"),e.appendChild(r);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M7 11V7a5 5 0 0 1 10 0v4"),e.appendChild(n);break;case"UNLOCK":let i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width","18"),i.setAttribute("height","11"),i.setAttribute("x","3"),i.setAttribute("y","11"),i.setAttribute("rx","2"),i.setAttribute("ry","2"),e.appendChild(i);let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M7 11V7a5 5 0 0 1 9.9-1"),e.appendChild(o);break;case"KEY":let c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d","m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 2.7a1 1 0 0 0-1.4 0L15.5 5"),e.appendChild(c);let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","m21 2-9.6 9.6"),e.appendChild(l);let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx","7.5"),a.setAttribute("cy","15.5"),a.setAttribute("r","5.5"),e.appendChild(a);break;case"SHIELD":let y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d","M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"),e.appendChild(y);break;case"SHIELD_CHECK":let d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d","M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"),e.appendChild(d);let g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d","m9 12 2 2 4-4"),e.appendChild(g);break;case"FOLDER":let h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d","M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"),e.appendChild(h);break;case"EYE":let p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d","M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10 7-10 7Z"),e.appendChild(p);let u=document.createElementNS("http://www.w3.org/2000/svg","circle");u.setAttribute("cx","12"),u.setAttribute("cy","12"),u.setAttribute("r","3"),e.appendChild(u);break;case"SEARCH":let w=document.createElementNS("http://www.w3.org/2000/svg","circle");w.setAttribute("cx","11"),w.setAttribute("cy","11"),w.setAttribute("r","8"),e.appendChild(w);let E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d","m21 21-4.35-4.35"),e.appendChild(E);break;case"INFO":let f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx","12"),f.setAttribute("cy","12"),f.setAttribute("r","10"),e.appendChild(f);let N=document.createElementNS("http://www.w3.org/2000/svg","path");N.setAttribute("d","M12 16v-4"),e.appendChild(N);let H=document.createElementNS("http://www.w3.org/2000/svg","path");H.setAttribute("d","M12 8h.01"),e.appendChild(H);break;case"ALERT_CIRCLE":let T=document.createElementNS("http://www.w3.org/2000/svg","circle");T.setAttribute("cx","12"),T.setAttribute("cy","12"),T.setAttribute("r","10"),e.appendChild(T);let k=document.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1","12"),k.setAttribute("x2","12"),k.setAttribute("y1","8"),k.setAttribute("y2","12"),e.appendChild(k);let A=document.createElementNS("http://www.w3.org/2000/svg","line");A.setAttribute("x1","12"),A.setAttribute("x2","12.01"),A.setAttribute("y1","16"),A.setAttribute("y2","16"),e.appendChild(A);break;case"CHECK_CIRCLE":let D=document.createElementNS("http://www.w3.org/2000/svg","path");D.setAttribute("d","M22 11.08V12a10 10 0 1 1-5.93-9.14"),e.appendChild(D);let j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("d","m9 11 3 3L22 4"),e.appendChild(j);break;case"X_CIRCLE":let M=document.createElementNS("http://www.w3.org/2000/svg","circle");M.setAttribute("cx","12"),M.setAttribute("cy","12"),M.setAttribute("r","10"),e.appendChild(M);let B=document.createElementNS("http://www.w3.org/2000/svg","line");B.setAttribute("x1","15"),B.setAttribute("x2","9"),B.setAttribute("y1","9"),B.setAttribute("y2","15"),e.appendChild(B);let I=document.createElementNS("http://www.w3.org/2000/svg","line");I.setAttribute("x1","9"),I.setAttribute("x2","15"),I.setAttribute("y1","9"),I.setAttribute("y2","15"),e.appendChild(I);break;case"SETTINGS":let U=document.createElementNS("http://www.w3.org/2000/svg","path");U.setAttribute("d","M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"),e.appendChild(U);let $=document.createElementNS("http://www.w3.org/2000/svg","circle");$.setAttribute("cx","12"),$.setAttribute("cy","12"),$.setAttribute("r","3"),e.appendChild($);break;case"REFRESH":let q=document.createElementNS("http://www.w3.org/2000/svg","path");q.setAttribute("d","M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"),e.appendChild(q);let Y=document.createElementNS("http://www.w3.org/2000/svg","path");Y.setAttribute("d","M21 3v5h-5"),e.appendChild(Y);let Z=document.createElementNS("http://www.w3.org/2000/svg","path");Z.setAttribute("d","M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"),e.appendChild(Z);let X=document.createElementNS("http://www.w3.org/2000/svg","path");X.setAttribute("d","M8 16H3v5"),e.appendChild(X);break;case"LOCK_OPEN":let S=document.createElementNS("http://www.w3.org/2000/svg","rect");S.setAttribute("width","18"),S.setAttribute("height","11"),S.setAttribute("x","3"),S.setAttribute("y","11"),S.setAttribute("rx","2"),S.setAttribute("ry","2"),e.appendChild(S);let Q=document.createElementNS("http://www.w3.org/2000/svg","path");Q.setAttribute("d","M7 11V7a5 5 0 0 1 9.9-1"),e.appendChild(Q);break;default:let O=document.createElementNS("http://www.w3.org/2000/svg","circle");O.setAttribute("cx","12"),O.setAttribute("cy","12"),O.setAttribute("r","10"),e.appendChild(O)}return e}function P(x,t="",s,e={}){let r=document.createElement("button");r.className="sankrypt-icon-button";let n=b(x,e.size||16,e.color);return r.appendChild(n),t&&(r.title=t),s&&r.addEventListener("click",s),e.style&&Object.assign(r.style,e.style),r}var z=class{constructor(t,s,e){this.app=t,this.plugin=s,this.file=e,this.container=null,this.encryptedContent=null,this.fileSize=0}async createView(){this.container=document.createElement("div"),this.container.className="sankrypt-encryption-viewer";try{this.encryptedContent=await this.app.vault.read(this.file),this.fileSize=new Blob([this.encryptedContent]).size,this.render()}catch(t){this.renderError(t)}return this.container}render(){this.container.empty();let s=this.container.createDiv({cls:"sankrypt-encryption-icon"}).createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"120",height:"120",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});s.createEl("rect",{attr:{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}}),s.createEl("path",{attr:{d:"M7 11V7a5 5 0 0 1 10 0v4"}}),s.style.color="var(--text-accent)",this.container.createEl("h1",{text:"ENCRYPTED FILE",cls:"sankrypt-encryption-title"}),this.container.createEl("div",{text:`This file "${this.file.name}" is encrypted with military-grade AES-256-GCM encryption. Enter the master password to decrypt and view its contents.`,cls:"sankrypt-encryption-subtitle"});let e=this.container.createDiv({cls:"sankrypt-encryption-info"}),r=e.createDiv(),n=b("INFO",20,"var(--text-accent)");r.appendChild(n),r.createEl("h3",{text:"File Information"});let i=e.createDiv({cls:"sankrypt-encryption-details"});[{label:"File Name:",value:this.file.name.replace(".skenc","")},{label:"Location:",value:this.file.path},{label:"Encrypted Size:",value:`${(this.fileSize/1024).toFixed(2)} KB`},{label:"Encryption:",value:"AES-256-GCM"}].forEach(u=>{let w=i.createDiv({cls:"sankrypt-encryption-detail"});w.createEl("span",{text:u.label,cls:"sankrypt-encryption-detail-label"}),w.createEl("span",{text:u.value,cls:"sankrypt-encryption-detail-value"})});let c=i.createDiv({attr:{style:"margin-top: 15px;"}});["Military-Grade","AES-256","PBKDF2","GCM Mode"].forEach(u=>{c.createEl("span",{text:u,cls:"sankrypt-encryption-tag"})});let l=this.container.createDiv({cls:"sankrypt-encryption-actions"}),a=l.createEl("button",{cls:"sankrypt-encryption-button sankrypt-encryption-button-primary"}),y=b("UNLOCK",20,"currentColor");a.appendChild(y),a.createEl("span",{text:"Decrypt File"}),a.addEventListener("click",async()=>{await this.plugin.decryptFile(this.file)});let d=l.createEl("button",{cls:"sankrypt-encryption-button sankrypt-encryption-button-secondary"}),g=b("EYE",20,"currentColor");d.appendChild(g),d.createEl("span",{text:"View Encrypted Data"}),d.addEventListener("click",()=>{this.showEncryptedData()});let h=this.container.createDiv({cls:"sankrypt-encryption-warning"}),p=b("ALERT_CIRCLE",20,"#ef4444");h.appendChild(p),h.createEl("p",{text:"WARNING: Without the correct master password, this file cannot be decrypted. Keep your password safe!"})}renderError(t){this.container.empty();let e=this.container.createDiv({cls:"sankrypt-encryption-icon"}).createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"120",height:"120",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});e.createEl("circle",{attr:{cx:"12",cy:"12",r:"10"}}),e.createEl("line",{attr:{x1:"12",x2:"12",y1:"8",y2:"12"}}),e.createEl("line",{attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"}}),e.style.color="#ef4444",this.container.createEl("h1",{text:"ERROR LOADING FILE",cls:"sankrypt-encryption-title",attr:{style:"color: #ef4444;"}}),this.container.createEl("div",{text:`Failed to load encrypted file: ${t.message}`,cls:"sankrypt-encryption-subtitle",attr:{style:"color: #ef4444;"}}),this.container.createEl("button",{text:"Retry",cls:"sankrypt-encryption-button sankrypt-encryption-button-primary",attr:{style:"margin-top: 20px;"}}).addEventListener("click",async()=>{try{this.encryptedContent=await this.app.vault.read(this.file),this.fileSize=new Blob([this.encryptedContent]).size,this.render()}catch(n){this.renderError(n)}})}showEncryptedData(){let t=new R.Modal(this.app);t.titleEl.textContent="Encrypted Data Preview";let s=t.contentEl;s.empty();let e=s.createDiv({attr:{style:"display: flex; align-items: center; gap: 10px; margin-bottom: 15px;"}}),r=b("KEY",24,"var(--text-accent)");e.appendChild(r),e.createEl("h3",{text:"Raw Encrypted Data",attr:{style:"margin: 0;"}}),s.createEl("div",{text:"This is the encrypted binary data in Base64 format. It cannot be read without the master password.",attr:{style:"margin-bottom: 15px; padding: 10px; background: var(--background-secondary); border-radius: 6px; font-size: 13px;"}});let n=s.createEl("textarea",{attr:{readonly:!0,style:"width: 100%; height: 300px; font-family: monospace; font-size: 11px; padding: 10px; border-radius: 6px; border: 1px solid var(--background-modifier-border); background: var(--background-primary); resize: vertical;"}});if(this.encryptedContent.length>1e3){let c=this.encryptedContent.substring(0,500),l=this.encryptedContent.substring(this.encryptedContent.length-500);n.value=`${c}

[... ${this.encryptedContent.length-1e3} characters ...]

${l}`}else n.value=this.encryptedContent;s.createEl("button",{text:"Copy to Clipboard",attr:{style:"margin-top: 15px; padding: 8px 16px; float: right;"}}).addEventListener("click",()=>{navigator.clipboard.writeText(this.encryptedContent),new R.Notice("Encrypted data copied to clipboard")}),s.createEl("button",{text:"Close",attr:{style:"margin-top: 15px; padding: 8px 16px;"}}).addEventListener("click",()=>t.close()),t.open()}},C=class{constructor(t,s,e={}){this.app=t,this.title=s,this.options={isConfirm:!1,showStrength:!1,...e},this.resolve=null,this.modal=null}open(){return new Promise(t=>{this.resolve=t,this.modal=new K(this.app,this.title,this.options,this),this.modal.open()})}},K=class extends R.Modal{constructor(t,s,e,r){super(t),this.title=s,this.options=e,this.parent=r,this.password="",this.strength=0,this.input=null}onOpen(){let{contentEl:t,modalEl:s}=this;t.empty(),t.addClass("sankrypt-modal");let e=t.createDiv({attr:{style:"display: flex; align-items: center; gap: 10px; margin-bottom: 20px;"}}),r=e.createDiv(),n=b("KEY",24,"var(--text-accent)");r.appendChild(n),e.createEl("h2",{text:this.title,attr:{style:"margin: 0;"}});let i=t.createDiv({attr:{style:`
          margin-bottom: 10px;
          padding: 8px 12px;
          background: rgba(59, 130, 246, 0.1);
          border-radius: 6px;
          border-left: 3px solid #3b82f6;
          font-size: 12px;
          color: var(--text-normal);
        `}}),o=i.createDiv({attr:{style:"display: flex; align-items: center; gap: 6px; margin-bottom: 4px;"}});o.appendChild(b("INFO",14,"#3b82f6")),o.createEl("strong",{text:"Remember:"}),i.createEl("div",{text:"The safest key is the one that exists only in your mind."});let c=t.createDiv({attr:{style:"margin: 20px 0; position: relative;"}});this.input=c.createEl("input",{type:"password",attr:{placeholder:"Enter your key . . . ",autocomplete:"new-password",style:`
          width: 100%;
          padding: 12px 40px 12px 12px;
          font-size: 16px;
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          box-sizing: border-box;
        `}});let l=c.createDiv({attr:{style:`
          position: absolute;
          right: 12px;
          top: 50%;
          transform: translateY(-50%);
          cursor: pointer;
          color: var(--text-muted);
          opacity: 0.7;
          transition: opacity 0.2s ease;
        `}}),a=b("EYE",20,"var(--text-muted)");l.appendChild(a);let y=!1;if(l.addEventListener("mouseenter",()=>l.style.opacity="1"),l.addEventListener("mouseleave",()=>l.style.opacity="0.7"),l.addEventListener("click",()=>{if(y=!y,this.input.type=y?"text":"password",y){for(;a.firstChild;)a.removeChild(a.firstChild);let p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d","M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10 7-10 7Z"),a.appendChild(p);let u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"),a.appendChild(u);let w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1","2"),w.setAttribute("x2","22"),w.setAttribute("y1","2"),w.setAttribute("y2","22"),a.appendChild(w)}else{for(;a.firstChild;)a.removeChild(a.firstChild);let p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d","M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10 7-10 7Z"),a.appendChild(p);let u=document.createElementNS("http://www.w3.org/2000/svg","circle");u.setAttribute("cx","12"),u.setAttribute("cy","12"),u.setAttribute("r","3"),a.appendChild(u)}}),setTimeout(()=>{this.input.focus(),this.input.select()},10),this.options.showStrength){let p=t.createDiv({attr:{style:"margin: 15px 0;"}}),w=p.createDiv({attr:{style:`
            height: 6px;
            background: var(--background-modifier-border);
            border-radius: 3px;
            overflow: hidden;
            margin: 5px 0;
          `}}).createDiv({attr:{style:`
            height: 100%;
            width: 0%;
            background: #ef4444;
            transition: width 0.3s ease, background 0.3s ease;
            border-radius: 3px;
          `}}),E=p.createDiv({attr:{style:"font-size: 12px; color: var(--text-muted); display: flex; justify-content: space-between;"}});E.createEl("span",{text:"Password strength:"});let f=E.createEl("span",{text:"None"});f.style.fontWeight="bold",this.input.addEventListener("input",()=>{let N=v.validatePassword(this.input.value);this.strength=N.strength,w.style.width=`${this.strength}%`,this.strength<40?(w.style.background="#ef4444",f.textContent="Weak",f.style.color="#ef4444"):this.strength<70?(w.style.background="#f59e0b",f.textContent="Moderate",f.style.color="#f59e0b"):this.strength<90?(w.style.background="#10b981",f.textContent="Strong",f.style.color="#10b981"):(w.style.background="#3b82f6",f.textContent="Very Strong",f.style.color="#3b82f6")})}let d=t.createDiv({attr:{style:"display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;"}}),g=P("X_CIRCLE","Cancel",()=>{this.close(),this.parent.resolve&&this.parent.resolve(null)},{size:18,style:{padding:"8px 16px",display:"flex",alignItems:"center",gap:"6px"}});g.appendChild(document.createTextNode(" Cancel"));let h=P("CHECK_CIRCLE",this.options.isConfirm?"Confirm":"Submit",()=>{this.password=this.input.value,this.close(),this.parent.resolve&&this.parent.resolve(this.password)},{size:18,style:{padding:"8px 16px",display:"flex",alignItems:"center",gap:"6px",background:"var(--interactive-accent)",color:"var(--text-on-accent)",border:"none"}});h.appendChild(document.createTextNode(` ${this.options.isConfirm?"Confirm":"Submit"}`)),d.appendChild(g),d.appendChild(h),this.input.addEventListener("keydown",p=>{p.key==="Enter"&&(this.password=this.input.value,this.close(),this.parent.resolve&&this.parent.resolve(this.password)),p.key==="Escape"&&(this.close(),this.parent.resolve&&this.parent.resolve(null))}),s.addEventListener("click",p=>{p.target===s&&(this.close(),this.parent.resolve&&this.parent.resolve(null))}),t.appendChild(d)}onClose(){let{contentEl:t}=this;t.empty(),this.parent.resolve&&!this.password&&this.parent.resolve(null)}},V=class{constructor(t,s,e){this.app=t,this.files=s,this.plugin=e,this.modal=null}open(t="decrypt"){this.modal=new W(this.app,this.files,this.plugin,t),this.modal.open()}},W=class extends R.Modal{constructor(t,s,e,r){super(t),this.files=s,this.plugin=e,this.action=r,this.selectedFiles=new Set}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("sankrypt-modal");let s=t.createDiv({attr:{style:"display: flex; align-items: center; gap: 10px; margin-bottom: 20px;"}}),e=s.createDiv(),r=b(this.action==="decrypt"?"FOLDER_SEARCH":"FOLDER",28,"var(--text-accent)");e.appendChild(r);let n=this.action==="decrypt"?"Decrypt Files":"Encrypted Files";s.createEl("h2",{text:`${n} (${this.files.length})`,attr:{style:"margin: 0;"}});let i=t.createDiv({attr:{style:"margin: 15px 0; display: flex; align-items: center; gap: 10px;"}}),o=b("SEARCH",18,"var(--text-muted)");i.appendChild(o);let c=i.createEl("input",{type:"search",placeholder:"Search encrypted files...",attr:{style:"flex: 1; padding: 10px 12px; border-radius: 6px; border: 1px solid var(--background-modifier-border);"}});setTimeout(()=>c.focus(),10);let l=t.createDiv({attr:{style:`
          max-height: 400px;
          overflow-y: auto;
          margin: 15px 0;
          border: 1px solid var(--background-modifier-border);
          border-radius: 8px;
          padding: 10px;
          background: var(--background-primary);
        `}});this.renderFileList(l,this.files),c.addEventListener("input",d=>{let g=d.target.value.toLowerCase(),h=this.files.filter(p=>p.name.toLowerCase().includes(g)||p.path.toLowerCase().includes(g));l.empty(),this.renderFileList(l,h)});let a=t.createDiv({attr:{style:"display: flex; gap: 10px; margin-top: 20px;"}});if(this.action==="decrypt"){let d=P("UNLOCK",`Decrypt Selected (${this.selectedFiles.size})`,async()=>{this.close();for(let h of this.selectedFiles){let p=this.files.find(u=>u.path===h);p&&await this.plugin.decryptFile(p)}},{size:18,style:{padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:"var(--interactive-accent)",color:"var(--text-on-accent)",border:"none"}});d.disabled=this.selectedFiles.size===0,a.appendChild(d);let g=P("UNLOCK","Decrypt All",async()=>{this.close();for(let h of this.files)await this.plugin.decryptFile(h)},{size:18,style:{padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",background:"var(--background-secondary)",border:"1px solid var(--background-modifier-border)"}});a.appendChild(g)}let y=P("X_CIRCLE",this.action==="decrypt"?"Cancel":"Close",()=>this.close(),{size:18,style:{padding:"10px 16px",display:"flex",alignItems:"center",gap:"8px",marginLeft:this.action==="decrypt"?"":"auto"}});a.appendChild(y),t.appendChild(a)}renderFileList(t,s){if(s.length===0){let e=t.createDiv({attr:{style:"text-align: center; padding: 40px 20px; color: var(--text-muted);"}}),r=b("SEARCH",48,"var(--background-modifier-border)");e.appendChild(r),e.createEl("div",{text:"No encrypted files found",attr:{style:"font-size: 14px; font-weight: bold; margin-bottom: 5px;"}}),e.createEl("div",{text:"Try a different search term",attr:{style:"font-size: 12px;"}});return}s.forEach(e=>{let r=t.createDiv({attr:{style:`
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: var(--background-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 2px solid transparent;
            transition: all 0.2s ease;
          `}}),n=this.selectedFiles.has(e.path);n&&(r.style.borderColor="var(--interactive-accent)",r.style.background="var(--background-modifier-hover)");let o=r.createDiv({attr:{style:"display: flex; align-items: center;"}}).createEl("input",{type:"checkbox",attr:{style:"width: 18px; height: 18px; cursor: pointer;"}});o.checked=n,o.addEventListener("change",g=>{g.stopPropagation(),o.checked?this.selectedFiles.add(e.path):this.selectedFiles.delete(e.path),this.onOpen()});let c=r.createDiv(),l=b("KEY",20,n?"var(--interactive-accent)":"var(--text-muted)");c.appendChild(l);let a=r.createDiv();a.style.flex="1",a.style.minWidth="0",a.createEl("div",{text:e.name.replace(".skenc",""),attr:{style:"font-weight: 600; font-size: 14px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"}}),a.createEl("div",{text:e.path,attr:{style:"font-size: 11px; color: var(--text-muted); opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"}});let y=r.createDiv({attr:{style:"display: flex; gap: 8px; align-items: center;"}});if(this.action==="decrypt"){let g=P("UNLOCK","Decrypt this file",async h=>{h.stopPropagation(),this.close(),await this.plugin.decryptFile(e)},{size:16,style:{padding:"6px"}});y.appendChild(g)}let d=P("EYE","View encrypted content",async g=>{g.stopPropagation(),await this.app.workspace.getLeaf().openFile(e)},{size:16,style:{padding:"6px"}});y.appendChild(d),r.addEventListener("click",g=>{g.target===o||g.target.closest("button")||(this.selectedFiles.has(e.path)?this.selectedFiles.delete(e.path):this.selectedFiles.add(e.path),this.onOpen())}),r.addEventListener("mouseenter",()=>{n||(r.style.background="var(--background-modifier-hover)",l.style.color="var(--text-normal)")}),r.addEventListener("mouseleave",()=>{n||(r.style.background="var(--background-secondary)",l.style.color="var(--text-muted)")}),t.appendChild(r)})}onClose(){let{contentEl:t}=this;t.empty()}};var m=require("obsidian"),_={autoLockMinutes:30,rememberPassword:!1,passwordHint:"",showEncryptedInExplorer:!0,defaultAction:"remove",encryptionLevel:"aes-256-gcm"},G=class extends m.PluginSettingTab{constructor(t,s){super(t,s),this.plugin=s}display(){let{containerEl:t}=this;t.empty();let s=t.createDiv({attr:{style:"display: flex; align-items: center; gap: 12px; margin-bottom: 30px;"}}),r=s.createDiv().createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});r.createEl("path",{attr:{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"}}),r.style.color="var(--text-accent)";let n=s.createDiv();n.createEl("h1",{text:"Sankrypt",attr:{style:"margin: 0 0 5px 0;"}}),n.createEl("div",{text:"Professional Encryption",attr:{style:"color: var(--text-muted); font-size: 14px;"}}),t.createEl("h2",{text:"General Settings",attr:{style:"padding-bottom: 10px; margin-top: 30px;"}}),new m.Setting(t).setName("Auto-lock timeout").setDesc("Automatically lock vault after X minutes of inactivity (0 = never)").addText(a=>{a.setPlaceholder("30").setValue(this.plugin.settings.autoLockMinutes.toString()).onChange(async y=>{let d=parseInt(y)||0;this.plugin.settings.autoLockMinutes=Math.max(0,d),await this.plugin.saveSettings(),this.plugin.resetAutoLockTimer()}),a.inputEl.addEventListener("focus",y=>y.stopPropagation())}),new m.Setting(t).setName("Show encrypted files in explorer").setDesc("Display .skenc files in the file explorer").addToggle(a=>a.setValue(this.plugin.settings.showEncryptedInExplorer).onChange(async y=>{this.plugin.settings.showEncryptedInExplorer=y,await this.plugin.saveSettings(),this.plugin.applyExplorerStyles()})),new m.Setting(t).setName("Default encryption action").setDesc("What happens when you encrypt a file").addDropdown(a=>a.addOption("remove","Remove unencrypted file").addOption("ask","Ask each time").addOption("keep","Keep both files").setValue(this.plugin.settings.defaultAction).onChange(async y=>{this.plugin.settings.defaultAction=y,await this.plugin.saveSettings()}));let i=t.createDiv({attr:{style:`
          background: rgba(245, 158, 11, 0.1);
          border: 1px solid rgba(245, 158, 11, 0.3);
          border-radius: 8px;
          padding: 15px;
          margin: 15px 0;
        `}});i.createEl("div",{text:"\u26A0\uFE0F Single Master Key Policy",attr:{style:"font-weight: bold; color: #f59e0b; margin-bottom: 5px;"}}),i.createEl("div",{text:"All encrypted files must use the same master password. When changing passwords, all existing files will be re-encrypted.",attr:{style:"font-size: 13px; color: var(--text-normal);"}}),t.createEl("h2",{text:"Security",attr:{style:"padding-bottom: 10px; margin-top: 40px;"}});let o=new m.Setting(t).setName("Password hint").setDesc("A hint to help you remember your master password.").addTextArea(a=>{let y=a.setPlaceholder(`e.g., "My cat's name + year I graduated"`).setValue(this.plugin.settings.passwordHint).onChange(async f=>{f.length>100&&(f=f.substring(0,100),a.setValue(f)),this.plugin.settings.passwordHint=f,await this.plugin.saveSettings()}),d=a.inputEl,g=document.createElement("div");g.style.cssText="width: 100%; margin-bottom: 5px;",d.parentNode.insertBefore(g,d),g.appendChild(d),d.style.cssText=`
          width: 100%;
          height: 100px;
          padding: 12px;
          margin: 0;
          border-radius: 8px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          color: var(--text-normal);
          font-size: 14px;
          font-family: var(--font-text);
          line-height: 1.5;
          resize: vertical;
          transition: all 0.2s ease;
          box-sizing: border-box;
          display: block;
        `;let h=document.createElement("div");h.style.cssText=`
          display: block;
          font-size: 12px;
          margin-top: 0;
          padding: 0 2px;
          font-family: var(--font-text);
          text-align: right;
        `;let p=document.createElement("div");p.style.cssText=`
          display: flex;
          justify-content: space-between;
          align-items: center;
          width: 100%;
        `;let u=document.createElement("span");u.style.cssText=`
          font-weight: 600;
          opacity: 0;
          transition: opacity 0.3s ease;
          text-align: left;
          flex: 1;
        `;let w=document.createElement("span");w.style.cssText=`
          text-align: right;
          margin-left: 10px;
          white-space: nowrap;
        `;let E=()=>{let f=d.value.length;w.textContent=`${f}/100`,f>100?(h.style.color="#ef4444",w.style.color="#ef4444",w.style.fontWeight="bold",u.textContent="Too long - truncated to 100 characters",u.style.color="#ef4444",u.style.opacity="1",d.style.borderColor="#ef4444",d.style.boxShadow="0 0 0 2px rgba(239, 68, 68, 0.1)"):f>80?(h.style.color="#f59e0b",w.style.color="#f59e0b",w.style.fontWeight="bold",u.textContent="Approaching limit",u.style.color="#f59e0b",u.style.opacity="1",d.style.borderColor="#f59e0b",d.style.boxShadow="0 0 0 2px rgba(245, 158, 11, 0.1)"):(h.style.color="var(--text-muted)",w.style.color=f>50?"var(--text-accent)":"var(--text-muted)",w.style.fontWeight="normal",u.style.opacity="0",d.style.borderColor="var(--background-modifier-border)",d.style.boxShadow="none")};p.appendChild(u),p.appendChild(w),h.appendChild(p),g.appendChild(h),E(),d.addEventListener("input",()=>{if(E(),d.value.length>100){d.value=d.value.substring(0,100);let f=new Event("input",{bubbles:!0});d.dispatchEvent(f),u.textContent="Auto-truncated to 100 characters",u.style.color="#ef4444",u.style.opacity="1",d.style.borderColor="#ef4444",setTimeout(()=>{d.value.length<=100&&(d.style.borderColor="var(--background-modifier-border)")},1e3)}}),d.addEventListener("focus",f=>{f.stopPropagation(),d.style.outline="2px solid var(--interactive-accent)",d.style.outlineOffset="2px",d.value.length<=100&&(d.style.borderColor="var(--interactive-accent)",d.style.boxShadow="0 0 0 3px rgba(var(--interactive-accent-rgb), 0.15)")}),d.addEventListener("blur",()=>{d.style.outline="none",d.value.length<=100&&(d.style.borderColor="var(--background-modifier-border)",d.style.boxShadow="none")})});t.createEl("h2",{text:"Advanced",attr:{style:"border-bottom: 1px solid var(--background-modifier-border); padding-bottom: 10px; margin-top: 40px; color: var(--text-error);"}});let c=t.createDiv({attr:{style:"background: var(--background-secondary); border-radius: 8px; padding: 20px; margin: 15px 0;"}});new m.Setting(c).setName("Clear all passwords").setDesc("Immediately lock vault and clear all passwords from memory").addButton(a=>a.setButtonText("Lock Vault Now").setCta().onClick(()=>{this.plugin.lockVault(),new m.Notice("Vault locked. Passwords cleared from memory.")})),new m.Setting(c).setName("Reset plugin").setDesc("Clear all plugin data and settings (does not affect encrypted files)").addButton(a=>a.setButtonText("Reset Plugin").setWarning().onClick(async()=>{confirm("Are you sure? This will clear all plugin settings but NOT decrypt any files.")&&(this.plugin.settings={..._},await this.plugin.saveSettings(),this.plugin.lockVault(),this.display(),new m.Notice("Plugin reset complete"))}));let l=t.createDiv({attr:{style:`
          margin-top: 40px;
          padding-top: 20px;
          border-top: 1px solid var(--background-modifier-border);
          text-align: center;
          font-size: 12px;
          color: var(--text-muted);
        `}});l.createEl("div",{text:"Sankrypt v1.0 - Professional Encryption"}),l.createEl("div",{text:"Always remember your master password! It cannot be recovered if lost.",attr:{style:"color: var(--text-error); margin-top: 5px;"}})}},F=class extends m.ItemView{constructor(t,s){super(t),this.plugin=s,this.file=null,this.viewer=null}getViewType(){return"sankrypt-encryption-view"}getDisplayText(){return this.file?`\u{1F510} ${this.file.name}`:"Encrypted File"}getIcon(){return"lock"}async onOpen(){}async setState(t,s){if(t&&t.file){let e=this.app.vault.getAbstractFileByPath(t.file);e&&e.path.endsWith(".skenc")&&await this.setFile(e)}return super.setState(t,s)}async setFile(t){this.file=t,this.containerEl.empty(),this.containerEl.addClass("sankrypt-encryption-view-container"),this.viewer=new z(this.app,this.plugin,t);let s=await this.viewer.createView();this.containerEl.appendChild(s),this.leaf.tabHeaderInnerTitleEl.setText(`\u{1F510} ${t.name}`),this.leaf.tabHeaderInnerTitleEl.title=`Encrypted: ${t.path}`,this.leaf.view.navigation=!0}getState(){return{file:this.file?this.file.path:null,...super.getState()}}async onClose(){this.viewer=null,this.file=null}};module.exports=class extends m.Plugin{constructor(){super(...arguments),this.masterPassword=null,this.encryptedFiles=new Set,this.autoLockTimer=null,this.lastActivity=Date.now(),this.settings=_,this.encryptionViewType=null,this.lastBlockedFile=null,this.blockedStatusInterval=null,this.statusBar=null}async onload(){console.log("Sankrypt v1.0 loading..."),await this.loadSettings(),this.registerEvent(this.app.workspace.on("file-open",()=>this.recordActivity())),this.registerEvent(this.app.workspace.on("click",()=>this.recordActivity())),this.registerEvent(this.app.workspace.on("keydown",()=>this.recordActivity())),this.encryptionViewType=this.registerView("sankrypt-encryption-view",t=>new F(t,this),!0),this.registerExtensions(["skenc"],"sankrypt-encryption-view"),this.registerEvent(this.app.workspace.on("file-open",async t=>{t&&t.path.endsWith(".skenc")&&await this.openEncryptedFile(t)})),this.addRibbonIcon("shield","Sankrypt",()=>this.showControlPanel()),this.registerCommands(),this.statusBar=this.addStatusBarItem(),this.updateStatusBar(),this.addSettingTab(new G(this.app,this)),this.applyExplorerStyles(),this.resetAutoLockTimer(),console.log("Sankrypt v1.0 loaded successfully!"),new m.Notice("Sankrypt v1.0 loaded")}registerCommands(){this.addCommand({id:"sankrypt-encrypt-current",name:"Encrypt current file",icon:"lock",hotkeys:[{modifiers:["Ctrl","Shift"],key:"E"}],checkCallback:t=>{let s=this.app.workspace.getActiveFile();return s&&!s.path.endsWith(".skenc")?(t||this.encryptFile(s),!0):!1}}),this.addCommand({id:"sankrypt-decrypt-current",name:"Decrypt current file",icon:"unlock",hotkeys:[{modifiers:["Ctrl","Shift"],key:"D"}],checkCallback:t=>{let s=this.app.workspace.getActiveFile(),e=!1,r=null;if(s&&s.path.endsWith(".skenc"))e=!0,r=s;else{let n=this.app.workspace.activeLeaf;if(n&&n.view instanceof F){let i=n.view;i.file&&i.file.path.endsWith(".skenc")&&(e=!0,r=i.file)}}if(r&&this.isFileBlocked(r)){if(!t){let n=Math.ceil((this.lastBlockedFile.blockedUntil-Date.now())/1e3);new m.Notice(`Decryption blocked for ${n} more seconds`)}return!1}return e?(t||this.decryptFile(r),!0):!1}}),this.addCommand({id:"sankrypt-show-files",name:"Show encrypted files",icon:"folder-search",hotkeys:[{modifiers:["Ctrl","Shift","Alt"],key:"F"}],callback:()=>this.showEncryptedFilesBrowser()}),this.addCommand({id:"sankrypt-lock-vault",name:"Lock vault",icon:"lock-open",callback:()=>this.lockVault()}),this.addCommand({id:"sankrypt-change-password",name:"Change master password",icon:"key",callback:()=>this.changeMasterPassword()})}async onunload(){console.log("Sankrypt unloading..."),this.lockVault(),this.autoLockTimer&&clearInterval(this.autoLockTimer),this.blockedStatusInterval&&(clearInterval(this.blockedStatusInterval),this.blockedStatusInterval=null)}isFileBlocked(t){return this.lastBlockedFile?Date.now()>=this.lastBlockedFile.blockedUntil?(this.lastBlockedFile=null,!1):t.path===this.lastBlockedFile.filePath:!1}async loadSettings(){this.settings=Object.assign({},_,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async ensureMasterPassword(t=!1,s=!1){if(this.masterPassword&&!t)return!0;let r=this.getAllEncryptedFiles().length>0;if(r&&(t||!this.masterPassword))return await this.verifyAgainstExistingFile();this.settings.passwordHint&&!t&&!r&&await this.confirmAction("Password Hint Available",`Your saved hint: "${this.settings.passwordHint}"

Do you want to use this hint or enter a new password?`,["Use Hint","Enter New Password"])==="Enter New Password"&&(t=!0);let n="",i=3,o=0;for(;o<i;){if(n=await new C(this.app,"Set Master Password",{showStrength:!0}).open(),!n)return!1;let l=v.validatePassword(n);if(!l.isValid){let a=l.issues.join(`
\u2022 `);if(await this.showErrorModal("Password Requirements",`Password does not meet requirements:

\u2022 ${a}

Strength: ${l.strength}/100`),o++,o>=i)return new m.Notice("Too many failed attempts. Please try again later."),!1;continue}if(!s){let y=await new C(this.app,"Confirm Master Password",{showStrength:!1}).open();if(!y)return!1;if(n!==y){o++;let d=i-o;if(new m.Notice("Passwords do not match"),await sleep(1e3),d>0){if(await this.confirmAction("Passwords Don't Match","Passwords do not match. Would you like to try again?",["Try Again","Cancel"])!=="Try Again")return!1;continue}else return await this.showErrorModal("Too Many Failed Attempts","Passwords did not match after multiple attempts. Please start over."),!1}}try{let y=await v.encrypt("Sankrypt encryption test",n);if(await v.decrypt(y,n),this.masterPassword=n,this.updateStatusBar(),new m.Notice("Master password set successfully"),(!this.settings.passwordHint||t)&&!s&&!r){let d=await this.promptForHint();d&&(this.settings.passwordHint=d,await this.saveSettings())}return!0}catch(a){return console.error("Password setup error:",a),new m.Notice("Failed to set master password"),!1}}return!1}async verifyAgainstExistingFile(){let t=this.getAllEncryptedFiles();if(t.length===0)return!0;let s=t[0],e=0,r=3;for(;e<r;){let i=await new C(this.app,"Verify Master Password",{showStrength:!1,isConfirm:!0}).open();if(!i)return!1;try{let o=await this.app.vault.read(s);return await v.decrypt(o,i),this.masterPassword=i,this.updateStatusBar(),this.resetAutoLockTimer(),await this.showSuccessModal("Password Verified",`Successfully verified password against existing encrypted files.

You have ${t.length} encrypted file(s) that will use this master password.`),!0}catch{e++;let c=r-e;if(c>0){if(await this.confirmAction("Wrong Password",`The password doesn't match existing encrypted files.
${c} attempt(s) remaining.

Try again?`,["Try Again","Cancel"])!=="Try Again")return!1}else return await this.showErrorModal("Access Denied",`Too many failed attempts.

You must provide the correct password for existing encrypted files.`),!1}}return!1}async showSuccessModal(t,s){return new Promise(e=>{new class extends m.Modal{constructor(n,i,o){super(n),this.title=i,this.message=o}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("sankrypt-modal");let i=n.createDiv({attr:{style:"display: flex; align-items: center; gap: 10px; margin-bottom: 20px;"}}),c=i.createDiv().createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});c.createEl("path",{attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}}),c.createEl("path",{attr:{d:"m9 11 3 3L22 4"}}),c.style.color="#10b981",i.createEl("h3",{text:t,attr:{style:"margin: 0; color: #10b981;"}}),n.createEl("div",{text:s,attr:{style:"white-space: pre-line; margin: 15px 0; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 6px; border-left: 4px solid #10b981;"}}),n.createEl("button",{text:"OK",cls:"mod-cta",attr:{style:"float: right; padding: 8px 16px; background: #10b981;"}}).addEventListener("click",()=>{this.close(),e()})}onClose(){let{contentEl:n}=this;n.empty(),e()}}(this.app,t,s).open()})}async promptForHint(){return new Promise(t=>{new class extends m.Modal{constructor(e){super(e),this.hint=""}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("sankrypt-modal");let r=e.createDiv({attr:{style:"display: flex; align-items: center; gap: 10px; margin-bottom: 20px;"}}),i=r.createDiv().createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});i.createEl("circle",{attr:{cx:"12",cy:"12",r:"10"}}),i.createEl("path",{attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}}),i.createEl("path",{attr:{d:"M12 17h.01"}}),i.style.color="var(--text-accent)",r.createEl("h3",{text:"Password Hint",attr:{style:"margin: 0;"}}),e.createEl("p",{text:"Create a hint to help you remember your password. This hint is stored locally and is NOT encrypted with your password."});let o=e.createEl("textarea",{attr:{placeholder:`e.g., "My first pet's name + year I graduated college"`,style:"width: 100%; height: 80px; padding: 12px; margin: 15px 0; border-radius: 6px; border: 1px solid var(--background-modifier-border); resize: vertical;"}});setTimeout(()=>o.focus(),10);let c=e.createDiv({attr:{style:"display: flex; justify-content: flex-end; gap: 10px;"}});c.createEl("button",{text:"Skip",attr:{style:"padding: 8px 16px;"}}).addEventListener("click",()=>{this.hint="",this.close(),t("")}),c.createEl("button",{text:"Save Hint",cls:"mod-cta",attr:{style:"padding: 8px 16px;"}}).addEventListener("click",()=>{this.hint=o.value.trim(),this.close(),t(this.hint)})}onClose(){let{contentEl:e}=this;e.empty(),t(this.hint)}}(this.app).open()})}async changeMasterPassword(){if(!this.masterPassword){new m.Notice("No master password set");return}let s=await new C(this.app,"Enter Current Password").open();if(s!==this.masterPassword){let n=this.getAllEncryptedFiles();if(n.length>0)try{let i=await this.app.vault.read(n[0]);await v.decrypt(i.substring(0,200),s),this.masterPassword=s}catch{new m.Notice("Incorrect current password");return}else{new m.Notice("Incorrect current password");return}}let e=await this.promptForNewPassword();if(!e)return;if(e===s){new m.Notice("New password cannot be the same as current password");return}let r=this.getAllEncryptedFiles();if(r.length>0){if(await this.confirmAction("Re-encrypt All Files",`This will re-encrypt ${r.length} file(s) with the new password.

IMPORTANT: All files must use the same master password.`,["Re-encrypt All","Cancel"])==="Re-encrypt All"){let i=0,o=0;for(let c of r)try{let l=await this.app.vault.read(c),a=await v.decrypt(l,s),y=await v.encrypt(a,e);await this.app.vault.modify(c,y),i++}catch(l){console.error(`Failed to re-encrypt ${c.name}:`,l),o++}o>0&&await this.showErrorModal("Partial Success",`Re-encrypted ${i} files, but ${o} failed.

This may indicate that some files use different passwords.`),this.masterPassword=e,this.updateStatusBar(),new m.Notice(`Password changed. ${i} files updated.`)}}else this.masterPassword=e,this.updateStatusBar(),new m.Notice("Master password changed successfully")}async promptForNewPassword(){let s=await new C(this.app,"Set New Master Password",{showStrength:!0}).open();if(!s)return null;let e=v.validatePassword(s);if(!e.isValid){let i=e.issues.join(`
\u2022 `);return await this.showErrorModal("Password Requirements",`Password does not meet requirements:

\u2022 ${i}

Strength: ${e.strength}/100`),null}return await new C(this.app,"Confirm New Master Password",{showStrength:!1}).open()!==s?(new m.Notice("Passwords do not match"),null):s}lockVault(){this.masterPassword=null,this.updateStatusBar(),this.resetAutoLockTimer(),new m.Notice("Vault locked - Passwords cleared from memory")}getAllEncryptedFiles(){return this.app.vault.getFiles().filter(t=>t.path.endsWith(".skenc"))}async openEncryptedFile(t){let s=this.app.workspace.getLeavesOfType("sankrypt-encryption-view");for(let r of s){let n=r.view;if(n instanceof F&&n.file&&n.file.path===t.path){this.app.workspace.revealLeaf(r);return}}await this.app.workspace.getLeaf(!0).setViewState({type:"sankrypt-encryption-view",active:!0,state:{file:t.path}})}async encryptFile(t){try{if(!await this.ensureMasterPassword())return;let s=t.path+".skenc",e=this.app.vault.getAbstractFileByPath(s),r=s,n=!1;if(e){let y=this.generateRandomSuffix(4);if(r=await this.generateUniqueFilename(t.path,y,!0),await this.confirmAction("File Conflict",`An encrypted file already exists at:
${s}

Create new encrypted file at:
${r}

Proceed?`,["Create New","Cancel"])!=="Create New")return;n=!0}if(await this.confirmAction("Encrypt File",`Encrypt "${t.name}"?

Original: ${t.path}
Encrypted: ${r}`,["Encrypt","Cancel"])!=="Encrypt")return;let o=await this.app.vault.read(t),c=await v.encrypt(o,this.masterPassword);await this.app.vault.create(r,c),this.encryptedFiles.add(r);let l=this.settings.defaultAction;if(l==="ask"){let y=await this.confirmAction("Original File","What would you like to do with the original file?",["Delete It","Keep Both","Cancel"]);if(y==="Delete It")await this.app.vault.delete(t);else if(y==="Cancel"){await this.app.vault.delete(this.app.vault.getAbstractFileByPath(r));return}}else if(l==="remove"){let y=this.app.workspace.getLeavesOfType("markdown");for(let d of y)if(d.view?.file?.path===t.path){await d.detach();break}await this.app.vault.delete(t)}if(this.settings.showEncryptedInExplorer){let y=this.app.vault.getAbstractFileByPath(r);y&&await this.openEncryptedFile(y)}this.updateStatusBar();let a=r.split("/").pop();n?new m.Notice(`"${t.name}" encrypted \u2192 ${a}`):new m.Notice(`"${t.name}" encrypted`)}catch(s){console.error("Sankrypt encryption error:",s),new m.Notice(`Encryption failed: ${s.message}`)}}async decryptFile(t,s=null,e=0,r=null){if(r&&Date.now()<r){let o=Math.ceil((r-Date.now())/1e3);await this.showErrorModal("Too Many Failed Attempts",`Please wait ${o} seconds before trying again.`);return}try{if(!s&&(s=this.masterPassword,!s&&(s=await new C(this.app,"Enter Master Password").open(),!s)))return;let o=await this.app.vault.read(t),c=await v.decrypt(o,s);if(!this.masterPassword){this.masterPassword=s,this.updateStatusBar(),this.resetAutoLockTimer();try{await this.verifyPasswordWithOtherFiles(s)}catch(w){console.warn("Sankrypt: Non-critical password verification issue:",w.message)}}let l=t.path.replace(".skenc",""),a=this.app.vault.getAbstractFileByPath(l),y=l,d=!1;if(a){let w=this.generateRandomSuffix(4);if(y=await this.generateUniqueFilename(t.path,w,!1),await this.confirmAction("File Conflict",`A file already exists at:
${l}

Create decrypted file at:
${y}

Proceed?`,["Create New","Cancel"])!=="Create New"){new m.Notice("Decryption cancelled");return}d=!0}await this.app.vault.create(y,c),this.encryptedFiles.delete(t.path),await this.app.vault.delete(t);let g=this.app.workspace.getLeavesOfType("sankrypt-encryption-view");for(let w of g)if(w.view.file&&w.view.file.path===t.path){await w.detach();break}let h=this.app.vault.getAbstractFileByPath(y);h&&await this.app.workspace.getLeaf().openFile(h),this.updateStatusBar();let p=y.split("/").pop(),u=t.name.replace(".skenc","");d?new m.Notice(`"${u}" decrypted \u2192 ${p}`):new m.Notice(`"${u}" decrypted`)}catch(o){if(console.error("Sankrypt decryption error:",o),e<3&&(o.message.includes("wrong key")||o.message.includes("Incorrect password")||o.message.includes("OperationError")||o.message.includes("decryption failed"))){let l=3-e-1,y=await new C(this.app,`Wrong Password (${l} attempt${l!==1?"s":""} left)`,{showStrength:!1}).open();if(y)return this.decryptFile(t,y,e+1,r);new m.Notice("Decryption cancelled");return}if(e>=3){let c=Date.now()+6e4;await this.showErrorModal("Too Many Failed Attempts",`Decryption is temporarily blocked for 1 minute.

Security measures:
\u2022 3 failed password attempts detected
\u2022 60-second timeout activated
\u2022 This prevents brute-force attacks

Please try again after the timeout expires.`),this.lastBlockedFile={filePath:t.path,blockedUntil:c},this.showBlockedStatus(t,c);return}new m.Notice("Decryption failed. File may be corrupted or wrong password.")}}async verifyPasswordWithOtherFiles(t){let s=this.getAllEncryptedFiles();if(s.length<=1)return;let e=0,r=0,n=Math.min(2,s.length-1);for(let i=0;i<n;i++)try{let o=s[i],c=await this.app.vault.read(o);await v.decrypt(c,t),e++}catch(o){r++,console.debug(`Sankrypt: Password verification failed for file ${i}:`,o.message)}n>0&&r>0&&e>0&&setTimeout(()=>{new m.Notice(`\u26A0\uFE0F Password works for ${e+1} file(s) but failed for ${r}.`,5e3)},1e3)}async checkPasswordConsistency(t){let s=this.getAllEncryptedFiles(),e=0,r=0,n=s.slice(0,Math.min(3,s.length));for(let i of n)try{let o=await this.app.vault.read(i);await v.decrypt(o.substring(0,200),t),e++}catch{r++}return{consistent:r===0,workingCount:e,failedCount:r,totalFiles:s.length}}showBlockedStatus(t,s){this.blockedStatusInterval&&clearInterval(this.blockedStatusInterval);let e=()=>{let r=Date.now();if(r>=s){this.blockedStatusInterval&&(clearInterval(this.blockedStatusInterval),this.blockedStatusInterval=null),this.updateStatusBar();return}let n=Math.ceil((s-r)/1e3);if(this.statusBar){this.statusBar.empty();let i=document.createElement("div");i.style.cssText=`
          display: flex;
          align-items: center;
          gap: 8px;
          cursor: pointer;
          padding: 2px 6px;
          border-radius: 4px;
          background: rgba(239, 68, 68, 0.1);
          border: 1px solid rgba(239, 68, 68, 0.3);
        `;let o=i.createDiv(),c=o.createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});c.createEl("circle",{attr:{cx:"12",cy:"12",r:"10"}}),c.createEl("line",{attr:{x1:"12",x2:"12",y1:"8",y2:"12"}}),c.createEl("line",{attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"}}),c.style.color="#ef4444";let l=i.createEl("span",{text:`Blocked (${n}s)`,attr:{style:"font-size: 12px; font-weight: 500; color: #ef4444;"}});i.appendChild(o),i.appendChild(l),this.statusBar.appendChild(i),i.onclick=()=>{this.showErrorModal("Decryption Blocked",`Decryption attempts are temporarily blocked.

\u2022 File: ${t.name}
\u2022 Time remaining: ${n} seconds
\u2022 Reason: Too many failed password attempts`)}}};e(),this.blockedStatusInterval=setInterval(e,1e3)}updateStatusBar(){let t=this.getAllEncryptedFiles();this.statusBar.empty();let s=document.createElement("div");s.style.cssText="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 2px 6px; border-radius: 4px;",s.addEventListener("mouseenter",()=>{s.style.background="var(--background-modifier-hover)"}),s.addEventListener("mouseleave",()=>{s.style.background="transparent"});let e=document.createElement("div");if(this.masterPassword){let n=e.createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});n.createEl("rect",{attr:{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}}),n.createEl("path",{attr:{d:"M7 11V7a5 5 0 0 1 10 0v4"}}),n.style.color="var(--text-accent)"}else{let n=e.createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});n.createEl("rect",{attr:{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}}),n.createEl("path",{attr:{d:"M7 11V7a5 5 0 0 1 9.9-1"}}),n.style.color="var(--text-muted)"}let r=document.createElement("span");r.style.fontSize="12px",r.style.fontWeight="500",this.masterPassword?(r.textContent=`${t.length} enc`,r.style.color="var(--text-accent)",s.title=`Sankrypt: Master password set
${t.length} encrypted files
Click for menu`):(r.textContent="Sankrypt",r.style.color="var(--text-muted)",s.title=`Sankrypt: No master password set
Click to set password`),s.appendChild(e),s.appendChild(r),this.statusBar.appendChild(s),s.onclick=()=>this.showControlPanel()}async showEncryptedFilesBrowser(){let t=this.getAllEncryptedFiles();if(t.length===0){new m.Notice("No encrypted files found");return}new V(this.app,t,this).open("decrypt")}showControlPanel(){new class extends m.Modal{constructor(s,e){super(s),this.plugin=e}onOpen(){let{contentEl:s}=this;s.empty(),s.addClass("sankrypt-control-panel");let e=s.createDiv({attr:{style:"text-align: center; margin-bottom: 30px;"}}),r=e.createDiv(),n=r.createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});n.createEl("path",{attr:{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"}}),n.style.color="var(--text-accent)",r.style.marginBottom="15px",e.createEl("h1",{text:"Sankrypt",attr:{style:"margin: 0 0 8px 0; color: var(--text-accent);"}}),e.createEl("div",{text:"Professional Encryption",attr:{style:"color: var(--text-muted); font-size: 14px; margin-bottom: 20px;"}});let i=this.plugin.getAllEncryptedFiles(),o=s.createDiv({attr:{style:`
              background: var(--background-secondary);
              border-radius: 10px;
              padding: 20px;
              margin: 0 0 30px 0;
              border-left: 4px solid ${this.plugin.masterPassword?"#10b981":"#ef4444"};
              display: flex;
              align-items: center;
              gap: 15px;
            `}}),c=o.createDiv();if(this.plugin.masterPassword){let h=c.createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});h.createEl("path",{attr:{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"}}),h.createEl("path",{attr:{d:"m9 12 2 2 4-4"}}),h.style.color="#10b981"}else{let h=c.createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});h.createEl("circle",{attr:{cx:"12",cy:"12",r:"10"}}),h.createEl("line",{attr:{x1:"12",x2:"12",y1:"8",y2:"12"}}),h.createEl("line",{attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"}}),h.style.color="#ef4444"}let l=o.createDiv();l.style.flex="1",this.plugin.masterPassword?(l.createEl("div",{text:"Master password set",attr:{style:"font-weight: bold; font-size: 16px; color: #10b981; margin-bottom: 5px;"}}),l.createEl("div",{text:`${i.length} encrypted files`,attr:{style:"font-size: 14px; color: var(--text-normal); margin-bottom: 5px;"}}),this.plugin.settings.passwordHint&&l.createEl("div",{text:`Hint: ${this.plugin.settings.passwordHint}`,attr:{style:"font-size: 12px; color: var(--text-muted); font-style: italic;"}})):(l.createEl("div",{text:"No master password set",attr:{style:"font-weight: bold; font-size: 16px; color: #ef4444; margin-bottom: 5px;"}}),l.createEl("div",{text:"Set a master password to start encrypting files",attr:{style:"font-size: 14px; color: var(--text-normal);"}})),s.createEl("h3",{text:"Quick Actions",attr:{style:"margin: 0 0 15px 0; font-size: 16px; color: var(--text-normal);"}});let a=s.createDiv({attr:{style:"display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 0 0 30px 0;"}});[{icon:this.plugin.masterPassword?"LOCK":"KEY",title:this.plugin.masterPassword?"Encrypt Current":"Set Password",desc:this.plugin.masterPassword?"Encrypt the currently open file":"Set a master password to begin",action:()=>{if(this.close(),this.plugin.masterPassword){let h=this.plugin.app.workspace.getActiveFile();h&&this.plugin.encryptFile(h)}else this.plugin.ensureMasterPassword()},color:this.plugin.masterPassword?"var(--text-normal)":"var(--interactive-accent)"},{icon:"UNLOCK",title:"Decrypt Current",desc:"Decrypt the currently open file",action:()=>{this.close();let p=this.plugin.app.workspace.getActiveFile();if(!p||!p.path.endsWith(".skenc")){let u=this.plugin.app.workspace.activeLeaf;if(u&&u.view instanceof F){let w=u.view;w.file&&w.file.path.endsWith(".skenc")&&(p=w.file)}}if(p&&p.path.endsWith(".skenc"))if(this.plugin.isFileBlocked(p)){let u=Math.ceil((this.plugin.lastBlockedFile.blockedUntil-Date.now())/1e3);new m.Notice(`Decryption blocked for ${u} more seconds`),this.plugin.showErrorModal("Decryption Blocked",`This file is temporarily blocked from decryption attempts.

\u2022 File: ${p.name}
\u2022 Blocked for: ${u} seconds
\u2022 Reason: Too many failed password attempts

Please wait and try again.`)}else this.plugin.decryptFile(p);else new m.Notice("No encrypted file is currently open")},color:"var(--text-normal)",disabled:!this.plugin.masterPassword},{icon:"FOLDER_SEARCH",title:"Browse Files",desc:"View and manage all encrypted files",action:()=>{this.close(),this.plugin.showEncryptedFilesBrowser()},color:"var(--text-normal)"},{icon:"SETTINGS",title:"Settings",desc:"Configure plugin settings",action:()=>{this.close(),this.plugin.app.setting.open(),this.plugin.app.setting.openTabById("sankrypt")},color:"var(--text-normal)"},{icon:"REFRESH",title:"Change Password",desc:"Change your master password",action:()=>{this.close(),this.plugin.changeMasterPassword()},color:"var(--text-normal)",disabled:!this.plugin.masterPassword},{icon:"LOCK_OPEN",title:"Lock Vault",desc:"Clear passwords from memory",action:()=>{this.close(),this.plugin.lockVault()},color:"var(--text-error)",disabled:!this.plugin.masterPassword}].forEach(h=>{let p=a.createDiv(),u=!1,w=0;if(h.title==="Decrypt Current"){let k=this.plugin.app.workspace.getActiveFile();if(!k||!k.path.endsWith(".skenc")){let A=this.plugin.app.workspace.activeLeaf;if(A&&A.view instanceof F){let D=A.view;D.file&&D.file.path.endsWith(".skenc")&&(k=D.file)}}k&&k.path.endsWith(".skenc")&&this.plugin.isFileBlocked(k)&&(u=!0,w=Math.ceil((this.plugin.lastBlockedFile.blockedUntil-Date.now())/1e3))}p.style.cssText=`
          padding: 16px;
          background: var(--background-primary);
          border: 1px solid var(--background-modifier-border);
          border-radius: 8px;
          cursor: ${h.disabled||u?"not-allowed":"pointer"};
          opacity: ${h.disabled||u?.5:1};
          transition: all 0.2s ease;
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          position: relative;
          ${u?"border-color: #ef4444; background: rgba(239, 68, 68, 0.05);":""}
        `;let E=p.createDiv(),f=b(h.icon,28,h.disabled||u?"var(--text-muted)":h.color);E.appendChild(f);let N=p.createEl("div",{text:h.title,attr:{style:`
              font-weight: 600;
              font-size: 13px;
              margin-bottom: 4px;
              ${u?"color: #ef4444;":""}
            `}}),H=p.createEl("div",{text:u?`Blocked for ${w}s - Too many attempts`:h.desc,attr:{style:`
              font-size: 11px;
              color: ${u?"#ef4444":"var(--text-muted)"};
              line-height: 1.3;
              margin-bottom: 4px;
              ${u?"font-weight: 600;":""}
            `}});!h.disabled&&!u?(p.addEventListener("mouseenter",()=>{p.style.background="var(--background-modifier-hover)",p.style.borderColor="var(--interactive-accent)",f.style.color="var(--interactive-accent)"}),p.addEventListener("mouseleave",()=>{p.style.background="var(--background-primary)",p.style.borderColor="var(--background-modifier-border)",f.style.color=h.color}),p.addEventListener("click",h.action)):u&&(p.title=`Decryption blocked for ${w} seconds
Too many failed password attempts`,p.addEventListener("mouseenter",()=>{p.style.background="rgba(239, 68, 68, 0.1)",p.style.borderColor="#ef4444"}),p.addEventListener("mouseleave",()=>{p.style.background="rgba(239, 68, 68, 0.05)",p.style.borderColor="#ef4444"}))});let d=s.createDiv({attr:{style:`
              margin-top: 30px;
              padding-top: 20px;
              border-top: 1px solid var(--background-modifier-border);
              text-align: center;
              font-size: 11px;
              color: var(--text-muted);
            `}});d.createEl("div",{text:"Hotkeys: Ctrl+Shift+E (Encrypt) | Ctrl+Shift+D (Decrypt) | Ctrl+Shift+Alt+F (Browse)"}),d.createEl("div",{text:"Always remember your master password! It cannot be recovered if lost.",attr:{style:"color: var(--text-error); margin-top: 5px; font-weight: bold;"}}),s.createEl("button",{text:"Close",attr:{style:"width: 100%; margin-top: 15px; padding: 10px; background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 6px;"}}).addEventListener("click",()=>this.close())}onClose(){let{contentEl:s}=this;s.empty()}}(this.app,this).open()}generateRandomSuffix(t=4){let s="abcdefghijklmnopqrstuvwxyz0123456789",e="";for(let r=0;r<t;r++)e+=s.charAt(Math.floor(Math.random()*s.length));return e}async generateUniqueFilename(t,s="",e=!1){let r=this.app.vault,n=t.split("/"),i=n.pop(),o=n.join("/")||"",c,l;if(e){let g=i.replace(/\.skenc$/,""),h=g.lastIndexOf(".");h===-1?(c=g,l=".skenc"):(c=g.substring(0,h),l=g.substring(h)+".skenc")}else if(i.endsWith(".skenc")){let g=i.slice(0,-6),h=g.lastIndexOf(".");h===-1?(c=g,l=""):(c=g.substring(0,h),l=g.substring(h))}else{let g=i.lastIndexOf(".");g===-1?(c=i,l=""):(c=i.substring(0,g),l=i.substring(g))}let a=1,y=(g,h,p=null)=>{let u=g;return h&&(u+=`-${h}`),p!==null&&(u+=`-${p}`),u+=l,o?`${o}/${u}`:u};if(!s){let g=y(c,"");if(!r.getAbstractFileByPath(g))return g}let d=y(c,s);if(!r.getAbstractFileByPath(d))return d;for(;;){let g=y(c,s,a);if(!r.getAbstractFileByPath(g))return g;if(a++,a>100)throw new Error("Could not find unique filename after 100 attempts")}}applyExplorerStyles(){let t=document.getElementById("sankrypt-explorer-styles");if(t&&t.remove(),this.settings.showEncryptedInExplorer){let s=document.createElement("style");s.id="sankrypt-explorer-styles",s.textContent=`
        .nav-file-title[data-path$=".skenc"] {
          color: var(--text-accent) !important;
          font-weight: 500 !important;
        }
        .nav-file-title[data-path$=".skenc"]:before {
          content: "";
          display: inline-block;
          width: 14px;
          height: 14px;
          margin-right: 6px;
          vertical-align: text-bottom;
          background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>');
          background-repeat: no-repeat;
          opacity: 0.7;
        }
        .nav-file-title[data-path$=".skenc"]:hover {
          background-color: var(--background-modifier-hover) !important;
        }
        .nav-file-title[data-path$=".skenc"].is-active {
          background-color: var(--interactive-accent) !important;
          color: var(--text-on-accent) !important;
        }
      `,document.head.appendChild(s)}}recordActivity(){this.lastActivity=Date.now()}resetAutoLockTimer(){this.autoLockTimer&&clearInterval(this.autoLockTimer),this.settings.autoLockMinutes>0&&this.masterPassword&&(this.autoLockTimer=setInterval(()=>{(Date.now()-this.lastActivity)/6e4>=this.settings.autoLockMinutes&&(this.lockVault(),new m.Notice("Vault auto-locked due to inactivity"))},6e4))}async confirmAction(t,s,e=["OK","Cancel"]){return new Promise(r=>{new class extends m.Modal{constructor(i,o,c,l){super(i),this.title=o,this.message=c,this.buttons=l,this.result=null,this.isClosed=!1}onOpen(){let{contentEl:i,modalEl:o}=this;i.empty(),i.addClass("sankrypt-modal"),i.createEl("h3",{text:this.title});let c=i.createEl("div",{text:this.message,attr:{style:"margin: 15px 0; white-space: pre-line; line-height: 1.5;"}}),l=i.createDiv({attr:{style:"display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;"}});this.buttons.forEach(a=>{let y=l.createEl("button",{text:a,attr:{style:"padding: 8px 16px;"}});a==="Cancel"||a==="No"?y.addEventListener("click",()=>{this.result=a,this.close(),r(a)}):(y.classList.add("mod-cta"),y.addEventListener("click",()=>{this.result=a,this.close(),r(a)}))}),o.addEventListener("click",a=>{a.target===o&&!this.isClosed&&(this.result="Cancel",this.close(),r("Cancel"))})}onClose(){let{contentEl:i}=this;this.isClosed=!0,i.empty(),!this.result&&this.buttons.includes("Cancel")?r("Cancel"):this.result||r(this.buttons[0])}}(this.app,t,s,e).open()})}async showErrorModal(t,s){return new Promise(e=>{new class extends m.Modal{constructor(n,i,o){super(n),this.title=i,this.message=o}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("sankrypt-modal");let i=n.createDiv({attr:{style:"display: flex; align-items: center; gap: 10px; margin-bottom: 20px;"}}),c=i.createDiv().createEl("svg",{attr:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}});c.createEl("circle",{attr:{cx:"12",cy:"12",r:"10"}}),c.createEl("line",{attr:{x1:"12",x2:"12",y1:"8",y2:"12"}}),c.createEl("line",{attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"}}),c.style.color="#ef4444",i.createEl("h3",{text:t,attr:{style:"margin: 0; color: #ef4444;"}}),n.createEl("div",{text:s,attr:{style:"white-space: pre-line; margin: 15px 0; padding: 15px; background: var(--background-secondary); border-radius: 6px; border-left: 4px solid #ef4444;"}}),n.createEl("button",{text:"OK",cls:"mod-cta",attr:{style:"float: right; padding: 8px 16px;"}}).addEventListener("click",()=>{this.close(),e()})}onClose(){let{contentEl:n}=this;n.empty(),e()}}(this.app,t,s).open()})}};
